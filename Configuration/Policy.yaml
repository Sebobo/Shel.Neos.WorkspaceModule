privilegeTargets:
  'Neos\Flow\Security\Authorization\Privilege\Method\MethodPrivilege':

    'Shel.Neos.WorkspaceModule:Backend.WorkspaceController':
      matcher: 'method(Neos\Neos\Controller\Module\Management\WorkspacesController->(index|show|update)Action())'

    'Shel.Neos.WorkspaceModule:Backend.PublishAllToLiveWorkspace':
      matcher: 'method(Shel\Neos\WorkspaceModule\Controller\WorkspacesController->publishWorkspaceAction(workspace.baseWorkspace.name === "live"))'

    'Shel.Neos.WorkspaceModule:Backend.CreateWorkspaces':
      matcher: 'method(Neos\Neos\Controller\Service\WorkspacesController->(new|create)Action()) || method(Shel\Neos\WorkspaceModule\Controller\Module\Management\WorkspacesController->(create|new)Action())'

    'Shel.Neos.WorkspaceModule:Backend.ManageSharedWorkspaces':
      matcher: 'method(Shel\Neos\WorkspaceModule\Controller\WorkspacesController->(publishWorkspace|discardWorkspace|edit|update|delete)Action()) && evaluate(this.workspace.owner !== current.userInformation.backendUser, this.workspace.personalWorkspace === false, current.workspaceDetails.sharedWorkspaces contains this.workspace)'

    'Shel.Neos.WorkspaceModule:Backend.DiscardSharedWorkspaces':
      matcher: 'method(Neos\Neos\Controller\Module\Management\WorkspacesController->discardWorkspaceAction(workspace.name in current.workspaceDetails.sharedWorkspaces))'

roles:
  'Neos.Neos:LivePublisher':
    privileges:
      - privilegeTarget: 'Shel.Neos.WorkspaceModule:Backend.PublishAllToLiveWorkspace'
        permission: GRANT

  'Neos.Neos:AbstractEditor':
    privileges:
      - privilegeTarget: 'Shel.Neos.WorkspaceModule:Backend.CreateWorkspaces'
        permission: GRANT

      - privilegeTarget: 'Shel.Neos.WorkspaceModule:Backend.WorkspaceController'
        permission: GRANT

      - privilegeTarget: 'Shel.Neos.WorkspaceModule:Backend.ManageSharedWorkspaces'
        permission: GRANT

      - privilegeTarget: 'Shel.Neos.WorkspaceModule:Backend.DiscardSharedWorkspaces'
        permission: GRANT

  'Neos.Neos:UserManager':
    privileges:
      - privilegeTarget: 'Shel.Neos.WorkspaceModule:Backend.WorkspaceController'
        permission: GRANT
